<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>후기 목록</title>
<style>

     @font-face {
            font-family: 'ChangwonDangamRound';
            src: url('./ChangwonDangamRound.ttf') format('truetype'); /* 같은 폴더에 파일이 있을 때 */
            /* src: url('./fonts/ChangwonDangamRound.ttf') format('truetype');  <- fonts/ 사용 시 이 줄로 대체 */
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        body {
    font-family: 'ChangwonDangamRound', Arial, sans-serif;
}


    
    h2 {
        margin-bottom: 20px;
    }

   
    #topButtons {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
    }

    .category-btn, .main-btn {
        padding: 8px 15px;
        border: 1px solid #bbb;
        border-radius: 6px;
        background: white;
        cursor: pointer;
    }

    .active {
        background: black !important;
        color: white !important;
        border-color: black !important;
    }

    #nameButtons {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 25px;
    }
    #typeBtn {
    display: flex;
    align-items: center;
    gap: 4px;
    font-weight: bold;
}


    
    .review-card {
        position: relative;
        background: white;
        padding: 15px;
        border-radius: 10px;
        border: 1px solid #ddd;
        margin-bottom: 15px;
    }

    .review-title {
        font-size: 1.1rem;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .review-info {
        color: #666;
        font-size: 0.9rem;
        margin-bottom: 8px;
    }

   
    .delete-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: red;
        color: white;
        border: none;
        padding: 5px 8px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.8rem;
    }

    
    #writeReviewBtn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #222;
    color: white;
    font-size: 16px;
    padding: 12px 18px;
    border-radius: 50px;
    border: none;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.25);
    z-index: 999;
}
#writeReviewBtn:hover {
    background: #444;
}

</style>
</head>
<body>

<h2>후기 목록</h2>


<div id="topButtons">
    <button id="allBtn" class="main-btn active" onclick="showAll()">전체 보기</button>
    <button id="typeBtn" class="main-btn" onclick="toggleType()">공연 ▼</button>
</div>


<div id="nameButtons"></div>


<div id="reviewList"></div>

<script>
let reviews = JSON.parse(localStorage.getItem("reviews") || "[]");

let currentType = "공연";



function toggleType() {
    currentType = (currentType === "공연" ? "극장" : "공연");
    document.getElementById("typeBtn").innerText = currentType + " ▼";
    renderNameButtons();
}


function renderNameButtons() {

    let container = document.getElementById("nameButtons");
    container.innerHTML = "";


    let filtered = reviews.filter(r => r.type === currentType);

    
    let names = [...new Set(filtered.map(r => r.item))];

    names.forEach(name => {
        let btn = document.createElement("button");
        btn.classList.add("category-btn");
        btn.innerText = name;

        btn.onclick = () => {
           
            document.querySelectorAll(".category-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");

            let list = reviews.filter(r => r.item === name);
            renderReviewList(list);
        };

        container.appendChild(btn);
    });
}



function showAll() {
    document.querySelectorAll(".main-btn").forEach(b => b.classList.remove("active"));
    document.getElementById("allBtn").classList.add("active");

    document.getElementById("nameButtons").innerHTML = "";
    renderReviewList(reviews);
}



function renderReviewList(list) {

    let reviewBox = document.getElementById("reviewList");
    reviewBox.innerHTML = "";

    if (list.length === 0) {
        reviewBox.innerHTML = "<p style='color:#777;'>후기가 없습니다.</p>";
        return;
    }

    list.forEach(r => {

        let card = document.createElement("div");
        card.className = "review-card";

        card.innerHTML = `
            <div class="review-title">${r.title}</div>
            <div class="review-info">
                • ${r.type}: ${r.item}<br>
                • 관람일: ${r.date}<br>
                • 별점: ${"★".repeat(r.stars)}${"☆".repeat(5 - r.stars)}
            </div>
            <p>${r.content}</p>
            <button class="delete-btn" onclick="deleteReview(${r.id})">삭제</button>
        `;

        reviewBox.appendChild(card);
    });
}



function deleteReview(id) {
    if (!confirm("정말 삭제할까요?")) return;

    reviews = reviews.filter(r => r.id !== id);
    localStorage.setItem("reviews", JSON.stringify(reviews));

    renderNameButtons();
    renderReviewList(reviews);
    alert("삭제되었습니다!");
}



renderNameButtons();
renderReviewList(reviews);
</script>

<button id="writeReviewBtn" onclick="goWritePage()">✏️ 후기쓰기</button>

<script>
function goWritePage() {
    window.location.href = "write.html";
}
</script>

</body>
</html>
